 SELECT DISTINCT Q.BUSINESS_ID, 
        Q.BUSINESS_TYPE, 
        Q.BUSINESS_TYPE SUP_MTRL_TYPE , 
        Q.CERTIFICATE_NO, 
        Q.DEADLINE                 END_DATE, 
        Q.ISSUE_DATE               START_DATE, 
        Q.ISSUING_AUTHORITY, 
        Q.IS_LONG_VALID, 
        Q.NP_QUALIFICATION_INFO_ID, 
        Q.QUALIFICATION_NAME, 
        S.SUPPLIER_NAME            PRODUCER_NAME, 
        M.MTRL_SPEC                PRODUCT_SPEC, 
        M.MTRL_NAME                PRODUCT_NAME, 
     (SELECT IF(GROUP_CONCAT(SAI.ATTACH_ID) = '' || GROUP_CONCAT(SAI.ATTACH_ID) IS NULL,'N','Y') 
     FROM SYS_ATTACHMENT_INFO SAI WHERE SAI.BUSSINESS_ID = Q.NP_QUALIFICATION_INFO_ID AND SAI.SUB_SYSTEM_CODE = 'NP' 
     AND SAI.ATTACH_TYPE = Q.QUALIFICATION_NAME AND SAI.BUSSINESS_TYPE = 'ZZ') SHOW_ATTACH_FLAG  
   FROM NP_QUALIFICATION_INFO Q 
  INNER JOIN np_qualification_push QP ON QP.QUALIFICATION_ID = q.NP_QUALIFICATION_INFO_ID 
    AND QP.STATUS IN ('N','Y') 
  INNER JOIN NP_MTRL_INFO M 
     ON Q.BUSINESS_ID = M.MTRL_PID 
    AND M.NP_SUPPLIER_ID = '1216924'  
    AND M.IS_USE=1  
    AND M.PRODUCT_TYPE = Q.BUSINESS_TYPE  
  INNER JOIN np_mtrl_info_push MIP ON MIP.MTRL_ID = M.MTRL_ID  
    AND MIP.STATUS IN ('N','Y') 
  INNER JOIN NP_SUPPLIER_INFO S 
     ON S.SUPPLIER_ID = M.SUPPLIER_ID 
   AND S.IS_USE=1  
  INNER JOIN SYS_PARAMETER P ON P.SYS_PARA_ID = '11023' 
   LEFT JOIN NP_PARAMETER NP ON NP.SYS_PARA_ID = '11023' AND NP.SUPPLIER_ID = '1216924' 
   LEFT JOIN NP_QUALIFICATION_INFO I 
     ON I.BUSINESS_ID = Q.BUSINESS_ID 
    AND I.BUSINESS_TYPE = Q.BUSINESS_TYPE 
    AND I.QUALIFICATION_NAME = Q.QUALIFICATION_NAME 
    AND I.NP_QUALIFICATION_INFO_ID != Q.NP_QUALIFICATION_INFO_ID AND I.DELETE_FLAG = 0  
    AND (I.IS_LONG_VALID = 1 OR 
        (DATEDIFF(DATE(I.DEADLINE), CURDATE()) - IFNULL(NP.PARA_VALUE,P.PARA_VALUE)) > 0) 
   LEFT JOIN np_qualification_push NQP ON NQP.QUALIFICATION_ID = I.NP_QUALIFICATION_INFO_ID  
    AND NQP.STATUS IN ('N','Y')   
  WHERE (Q.BUSINESS_TYPE = 'WZ' OR Q.BUSINESS_TYPE = 'YP') 
    AND (DATEDIFF(DATE(Q.DEADLINE), CURDATE()) - IFNULL(NP.PARA_VALUE,P.PARA_VALUE)) <= 0 
    AND (Q.IS_LONG_VALID IS NOT NULL OR Q.IS_LONG_VALID = 0) 
    AND Q.DELETE_FLAG = 0  
    AND NQP.QUALIFICATION_ID IS NULL  
